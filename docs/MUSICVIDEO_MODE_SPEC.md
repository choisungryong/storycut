# STORYCUT 뮤직비디오 모드 기획서

## 1. 개요

### 1.1 목적
Suno AI 등에서 생성한 음악을 업로드하면, AI가 자동으로 뮤직비디오를 생성해주는 기능.

### 1.2 핵심 가치
- **진입 장벽 제거**: 영상 제작 경험 없이도 뮤직비디오 제작 가능
- **시간/비용 절감**: 기존 수주~수개월 → 몇 분
- **크리에이터 경제**: 인디 뮤지션, 유튜버, 웹소설 작가 등 타겟

### 1.3 타겟 사용자
| 사용자 | 니즈 |
|--------|------|
| 인디 뮤지션 | Suno로 만든 음악에 비주얼 추가 |
| 유튜버 | BGM 채널, 스토리텔링 채널 |
| 웹소설 작가 | 자작곡 + 세계관 비주얼화 |
| 일반인 | 기념일 영상, 팬메이드 MV |

---

## 2. 사용자 플로우

```
┌─────────────────────────────────────────────────────────────┐
│                    STORYCUT 메인 화면                        │
├─────────────────────────────────────────────────────────────┤
│  [새 영상 만들기]        [🎵 뮤직비디오 만들기]  ← NEW      │
│                              │                              │
└──────────────────────────────┼──────────────────────────────┘
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                   Step 1: 음악 업로드                        │
├─────────────────────────────────────────────────────────────┤
│  🎵 음악 파일 업로드 (mp3, wav, m4a)                        │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  [파일 선택] 또는 드래그 앤 드롭                      │    │
│  │  지원 형식: mp3, wav, m4a | 최대 10분               │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  ✅ 분석 완료: 3분 42초 | BPM: 128 | 분위기: Energetic      │
│                                                             │
│                              [다음 →]                        │
└─────────────────────────────────────────────────────────────┘
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                   Step 2: 가사 & 컨셉 입력                   │
├─────────────────────────────────────────────────────────────┤
│  📝 가사 입력 (선택)                                        │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  [Verse 1]                                          │    │
│  │  어둠 속에서 빛나는 별처럼                            │    │
│  │  너를 향해 걸어가는 나                                │    │
│  │                                                     │    │
│  │  [Chorus]                                           │    │
│  │  We are the light, shining bright...                │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  🎨 비주얼 컨셉                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  장르: [판타지 ▼]  분위기: [서사적 ▼]                 │    │
│  │  스타일: [Cinematic ▼]                               │    │
│  │                                                     │    │
│  │  추가 설명 (선택):                                   │    │
│  │  "중세 기사가 용을 무찌르는 여정"                     │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│                      [← 이전]  [생성 시작 →]                 │
└─────────────────────────────────────────────────────────────┘
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                   Step 3: 씬 구성 미리보기                   │
├─────────────────────────────────────────────────────────────┤
│  🎬 AI가 분석한 씬 구성 (수정 가능)                         │
│                                                             │
│  ┌──────┬──────┬──────┬──────┬──────┬──────┐               │
│  │ 0:00 │ 0:32 │ 1:05 │ 1:45 │ 2:20 │ 3:10 │               │
│  │Intro │Verse1│Chorus│Verse2│Chorus│Outro │               │
│  │ 🌙   │ ⚔️   │ 🔥   │ 🏰   │ 🐉   │ 🌅   │               │
│  └──────┴──────┴──────┴──────┴──────┴──────┘               │
│                                                             │
│  [씬 1] 0:00 - 0:32 (Intro)                                │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 비주얼: 달빛 아래 고요한 숲, 안개가 피어오르는...     │    │
│  │ [수정]                                              │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│                      [← 이전]  [영상 생성 →]                 │
└─────────────────────────────────────────────────────────────┘
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                   Step 4: 생성 중                            │
├─────────────────────────────────────────────────────────────┤
│  ⏳ 뮤직비디오 생성 중... (예상 시간: 3~5분)                 │
│                                                             │
│  ████████████░░░░░░░░░░░░░░ 45%                            │
│                                                             │
│  ✅ 씬 1/6 이미지 생성 완료                                 │
│  ✅ 씬 2/6 이미지 생성 완료                                 │
│  🔄 씬 3/6 이미지 생성 중...                                │
│  ⏳ 씬 4/6 대기 중                                          │
│                                                             │
│  [실시간 미리보기]                                          │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  🖼️ 생성된 이미지들이 여기 표시됩니다                 │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                   Step 5: 완료!                              │
├─────────────────────────────────────────────────────────────┤
│  🎉 뮤직비디오가 완성되었습니다!                             │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                                                     │    │
│  │               [▶️ 비디오 플레이어]                   │    │
│  │                    3:42                             │    │
│  │                                                     │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  [📥 다운로드]  [🔄 재생성]  [✏️ 씬 수정]                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 입력/출력 스펙

### 3.1 입력 (Input)

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| `music_file` | File (mp3/wav/m4a) | ✅ | 음악 파일 (최대 10분) |
| `lyrics` | String | ❌ | 가사 텍스트 (구간 태그 포함 가능) |
| `concept` | String | ❌ | 비주얼 컨셉 설명 |
| `genre` | Enum | ✅ | 판타지, 로맨스, 액션, 공포 등 |
| `mood` | Enum | ✅ | 서사적, 몽환적, 격렬한, 잔잔한 등 |
| `style` | Enum | ✅ | cinematic, anime, webtoon, realistic |

### 3.2 출력 (Output)

| 필드 | 타입 | 설명 |
|------|------|------|
| `video_url` | String | 최종 뮤직비디오 URL |
| `duration_sec` | Int | 영상 길이 (음악과 동일) |
| `scenes` | Array | 씬별 이미지/타임스탬프 |
| `thumbnail_url` | String | 자동 생성된 썸네일 |

---

## 4. 기술 설계

### 4.1 음악 분석 모듈

```python
# 사용 라이브러리: librosa, pydub

class MusicAnalyzer:
    def analyze(self, audio_path: str) -> MusicAnalysis:
        """
        Returns:
            - duration_sec: 전체 길이
            - bpm: 비트 템포
            - segments: 구간 분할 (intro, verse, chorus 등)
            - mood: 분위기 추정 (energetic, calm, dark...)
            - key_timestamps: 주요 전환 포인트
        """
```

### 4.2 가사 파서

```python
class LyricsParser:
    def parse(self, lyrics_text: str, duration_sec: float) -> List[LyricSegment]:
        """
        가사를 구간별로 분할.

        [Verse 1], [Chorus] 등 태그가 있으면 활용.
        없으면 문단 기준으로 자동 분할.

        Returns:
            - segment_id: 구간 ID
            - start_sec: 시작 시간
            - end_sec: 종료 시간
            - text: 가사 텍스트
            - mood_hint: 분위기 힌트
        """
```

### 4.3 씬 생성기

```python
class MVSceneGenerator:
    def generate_scenes(
        self,
        music_analysis: MusicAnalysis,
        lyrics_segments: List[LyricSegment],
        concept: str,
        style: str
    ) -> List[MVScene]:
        """
        음악 분석 + 가사를 기반으로 씬 구성.

        Returns:
            - scene_id: 씬 ID
            - start_sec: 시작 시간
            - end_sec: 종료 시간
            - image_prompt: 이미지 생성 프롬프트
            - transition: 전환 효과 (fade, cut, zoom)
        """
```

### 4.4 파이프라인

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ MusicAnalyzer│ ──▶ │ LyricsParser │ ──▶ │SceneGenerator│
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  ImageAgent │ ◀── │  MVPipeline │ ──▶ │ FFmpegComposer│
└─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
                                        [Final MV.mp4]
```

---

## 5. API 설계

### 5.1 음악 업로드 & 분석

```
POST /api/mv/upload
Content-Type: multipart/form-data

Request:
  - music_file: File

Response:
{
  "project_id": "mv_abc123",
  "analysis": {
    "duration_sec": 222,
    "bpm": 128,
    "mood": "energetic",
    "segments": [
      {"type": "intro", "start": 0, "end": 32},
      {"type": "verse", "start": 32, "end": 65},
      ...
    ]
  }
}
```

### 5.2 MV 생성 요청

```
POST /api/mv/generate
Content-Type: application/json

Request:
{
  "project_id": "mv_abc123",
  "lyrics": "어둠 속에서 빛나는 별처럼...",
  "concept": "중세 기사가 용을 무찌르는 여정",
  "genre": "fantasy",
  "mood": "epic",
  "style": "cinematic"
}

Response:
{
  "project_id": "mv_abc123",
  "status": "processing",
  "estimated_time_sec": 180
}
```

### 5.3 상태 조회

```
GET /api/mv/status/{project_id}

Response:
{
  "status": "processing" | "completed" | "failed",
  "progress": 45,
  "current_step": "Generating scene 3/6",
  "scenes": [
    {"scene_id": 1, "status": "completed", "image_url": "..."},
    {"scene_id": 2, "status": "completed", "image_url": "..."},
    {"scene_id": 3, "status": "generating"},
    ...
  ]
}
```

### 5.4 결과 조회

```
GET /api/mv/result/{project_id}

Response:
{
  "video_url": "/media/mv_abc123/final_mv.mp4",
  "thumbnail_url": "/media/mv_abc123/thumbnail.jpg",
  "duration_sec": 222,
  "scenes": [...],
  "download_url": "/api/mv/download/mv_abc123"
}
```

---

## 6. 구현 단계 (Phase)

### Phase 1: MVP (1주)
- [ ] 음악 업로드 API
- [ ] 기본 음악 분석 (길이, BPM)
- [ ] 수동 씬 분할 (사용자가 타임스탬프 입력)
- [ ] 기존 ImageAgent 재활용
- [ ] FFmpeg로 음악 + 영상 합성
- [ ] 기본 UI (별도 탭)

### Phase 2: 자동화 (2주)
- [ ] 자동 씬 분할 (음악 분석 기반)
- [ ] 가사 파서 (구간 태그 지원)
- [ ] 분위기 감지 (librosa feature extraction)
- [ ] 프로그레시브 미리보기

### Phase 3: 고급 기능 (3주)
- [ ] 비트 싱크 (컷 전환을 비트에 맞춤)
- [ ] 전환 효과 (fade, zoom, slide)
- [ ] 텍스트 오버레이 (가사 자막)
- [ ] 스타일 앵커 (일관된 비주얼)

### Phase 4: 최적화 (4주)
- [ ] I2V (이미지 → 비디오) 통합
- [ ] 캐릭터 일관성 (뮤비 전체에서 같은 캐릭터)
- [ ] 템플릿 시스템 (장르별 프리셋)

---

## 7. 기술 스택

| 영역 | 기술 |
|------|------|
| 음악 분석 | librosa, pydub |
| 이미지 생성 | Gemini 2.5 Flash Image (기존 재활용) |
| 영상 합성 | FFmpeg |
| 백엔드 | FastAPI (기존 확장) |
| 프론트엔드 | Vanilla JS (기존 확장) |
| 스토리지 | 로컬 / R2 (기존 재활용) |

---

## 8. 리스크 & 대응

| 리스크 | 대응 |
|--------|------|
| 음악 저작권 이슈 | 사용자 책임 명시, Suno AI 등 생성 음악 권장 |
| 긴 음악 처리 시간 | 10분 제한, 백그라운드 처리 |
| 씬-음악 싱크 불일치 | 사용자 수동 조정 UI 제공 |
| 비주얼 일관성 | 스타일 앵커 + 캐릭터 앵커 활용 |

---

## 9. 성공 지표

| 지표 | 목표 |
|------|------|
| 생성 완료율 | > 95% |
| 평균 생성 시간 | < 5분 (3분 음악 기준) |
| 사용자 만족도 | 재생성 비율 < 20% |
| 일간 생성 수 | MVP 후 1주일 내 100건 |

---

## 10. 다음 단계

1. **기획 확정** ← 현재
2. 백엔드 스키마/모델 정의
3. 음악 분석 모듈 프로토타입
4. API 엔드포인트 구현
5. 프론트엔드 UI 구현
6. 통합 테스트
7. 배포 & 피드백

---

*Last Updated: 2026-02-05*
*Author: Claude (AI Director)*
