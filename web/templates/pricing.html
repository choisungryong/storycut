<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš”ê¸ˆì œ - Klippa</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LKY35WHBTE"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LKY35WHBTE');
    </script>
    <meta name="description" content="Klippa ìš”ê¸ˆì œ. ë¬´ë£Œ 30í¬ë ˆë”§ìœ¼ë¡œ ì‹œì‘í•˜ê±°ë‚˜, ì—…ê·¸ë ˆì´ë“œí•˜ì—¬ ë” ë§ì€ AI ì˜ìƒì„ ìƒì„±í•˜ì„¸ìš”.">
    <meta property="og:title" content="ìš”ê¸ˆì œ - Klippa">
    <meta property="og:description" content="Klippa ìš”ê¸ˆì œ. ë¬´ë£Œ 30í¬ë ˆë”§ìœ¼ë¡œ ì‹œì‘í•˜ê±°ë‚˜, ì—…ê·¸ë ˆì´ë“œí•˜ì—¬ ë” ë§ì€ AI ì˜ìƒì„ ìƒì„±í•˜ì„¸ìš”.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/static/assets/klippa-logo.png">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .pricing-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .pricing-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .pricing-header h1 {
            font-size: 2.2rem;
            margin: 0 0 12px;
            background: linear-gradient(135deg, #00adb5, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .pricing-header p {
            color: #888;
            font-size: 1.1rem;
            margin: 0;
        }

        .back-link {
            display: inline-block;
            color: #00adb5;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        /* í¬ë ˆë”§ ì”ì•¡ í‘œì‹œ */
        .balance-card {
            background: linear-gradient(135deg, #1e1e2e, #252a34);
            border: 1px solid #f59e0b44;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            margin-bottom: 40px;
        }

        .balance-card .balance-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: #f59e0b;
        }

        .balance-card .balance-label {
            color: #888;
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .balance-card .plan-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .plan-badge.free {
            background: #333;
            color: #888;
        }

        .plan-badge.lite {
            background: #3b82f622;
            color: #60a5fa;
            border: 1px solid #3b82f644;
        }

        .plan-badge.pro {
            background: #8b5cf622;
            color: #a78bfa;
            border: 1px solid #8b5cf644;
        }

        .plan-badge.premium {
            background: #f59e0b22;
            color: #fbbf24;
            border: 1px solid #f59e0b44;
        }

        /* êµ¬ë… í”Œëœ ê·¸ë¦¬ë“œ */
        .plans-section h2,
        .packs-section h2 {
            text-align: center;
            margin: 0 0 24px;
            font-size: 1.4rem;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 20px;
            margin-bottom: 48px;
        }

        .plan-card {
            background: #1e1e2e;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 28px 24px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }

        .plan-card:hover {
            border-color: #00adb5;
            transform: translateY(-4px);
        }

        .plan-card.popular {
            border-color: #8b5cf6;
        }

        .plan-card.popular::before {
            content: '\C778\AE30';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #8b5cf6;
            color: white;
            padding: 3px 16px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .plan-card .plan-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0 0 8px;
        }

        .plan-card .plan-price {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
            margin: 12px 0 4px;
        }

        .plan-card .plan-price span {
            font-size: 0.9rem;
            font-weight: 400;
            color: #888;
        }

        .plan-card .plan-clips {
            color: #f59e0b;
            font-weight: 600;
            font-size: 1rem;
            margin: 12px 0;
        }

        .plan-card .plan-features {
            list-style: none;
            padding: 0;
            margin: 16px 0 24px;
            text-align: left;
        }

        .plan-card .plan-features li {
            padding: 4px 0;
            color: #aaa;
            font-size: 0.85rem;
        }

        .plan-card .plan-features li::before {
            content: '\2713 ';
            color: #00adb5;
            font-weight: bold;
        }

        .plan-btn {
            display: block;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .plan-btn.primary {
            background: linear-gradient(135deg, #00adb5, #0891b2);
            color: white;
        }

        .plan-btn.primary:hover {
            opacity: 0.9;
        }

        .plan-btn.secondary {
            background: #333;
            color: #ccc;
            border: 1px solid #555;
        }

        .plan-btn.popular {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .plan-btn:disabled {
            opacity: 0.5;
            cursor: default;
        }

        /* í¬ë ˆë”§ íŒ© */
        .packs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 48px;
        }

        .pack-card {
            background: #1e1e2e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s;
        }

        .pack-card:hover {
            border-color: #f59e0b;
            transform: translateY(-2px);
        }

        .pack-card .pack-clips {
            font-size: 1.8rem;
            font-weight: 700;
            color: #f59e0b;
        }

        .pack-card .pack-price {
            font-size: 1.2rem;
            color: #ccc;
            margin: 8px 0 16px;
        }

        .pack-card .pack-unit {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 12px;
        }

        .pack-btn {
            display: block;
            width: 100%;
            padding: 10px;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            background: transparent;
            color: #f59e0b;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pack-btn:hover {
            background: #f59e0b22;
        }

        /* í¬ë ˆë”§ ë¹„ìš© í‘œ */
        .costs-section {
            background: #1e1e2e;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 48px;
        }

        .costs-section h2 {
            margin: 0 0 16px;
            font-size: 1.2rem;
        }

        .costs-table {
            width: 100%;
            border-collapse: collapse;
        }

        .costs-table th,
        .costs-table td {
            padding: 10px 16px;
            text-align: left;
            border-bottom: 1px solid #333;
        }

        .costs-table th {
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .costs-table td:last-child {
            text-align: right;
            color: #f59e0b;
            font-weight: 600;
        }

        /* ë¹Œë§ í† ê¸€ */
        .billing-toggle {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 32px;
            background: #1a1a2e;
            border-radius: 10px;
            padding: 4px;
            border: 1px solid #333;
            display: inline-flex;
        }

        .billing-toggle-wrap {
            text-align: center;
        }

        .billing-toggle button {
            padding: 8px 24px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: #888;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .billing-toggle button.active {
            background: #00adb5;
            color: white;
        }

        .save-badge {
            font-size: 0.75rem;
            color: #10b981;
            margin-left: 4px;
        }

        /* ê±°ë˜ ë‚´ì—­ */
        .history-section {
            background: #1e1e2e;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 28px;
        }

        .history-section h2 {
            margin: 0 0 16px;
            font-size: 1.2rem;
        }

        .tx-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tx-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2a2a3a;
        }

        .tx-item:last-child {
            border-bottom: none;
        }

        .tx-desc {
            color: #ccc;
            font-size: 0.9rem;
        }

        .tx-date {
            color: #666;
            font-size: 0.75rem;
        }

        .tx-amount {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .tx-amount.positive {
            color: #10b981;
        }

        .tx-amount.negative {
            color: #ef4444;
        }

        .load-more-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 12px;
            background: transparent;
            border: 1px solid #333;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
        }

        .load-more-btn:hover {
            border-color: #555;
            color: #ccc;
        }

        /* ì„±ê³µ ë©”ì‹œì§€ */
        .success-banner {
            background: #10b98122;
            border: 1px solid #10b98144;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            color: #10b981;
            margin-bottom: 24px;
            font-weight: 500;
        }

        /* ê´€ë¦¬ ë²„íŠ¼ */
        .manage-section {
            text-align: center;
            margin-bottom: 32px;
        }

        .manage-btn {
            padding: 10px 24px;
            border: 1px solid #555;
            border-radius: 8px;
            background: transparent;
            color: #ccc;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .manage-btn:hover {
            border-color: #888;
            color: #fff;
        }
    </style>
</head>

<body>
    <div class="pricing-container">
        <a href="/index.html" class="back-link">&larr; ì•±ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

        <div class="pricing-header">
            <h1>ìš”ê¸ˆì œ ì„ íƒ</h1>
            <p>í¬ë ˆë”§ìœ¼ë¡œ AI ì˜ìƒì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”</p>
        </div>

        <!-- ì„±ê³µ ë°°ë„ˆ (ê²°ì œ í›„) -->
        <div id="success-banner" class="success-banner" style="display:none;"></div>

        <!-- í¬ë ˆë”§ ì”ì•¡ -->
        <div class="balance-card" id="balance-card" style="display:none;">
            <div class="balance-amount" id="pricing-clip-count">-</div>
            <div class="balance-label">ë³´ìœ  í¬ë ˆë”§</div>
            <div>
                <span class="plan-badge free" id="pricing-plan-badge">Free</span>
            </div>
        </div>

        <!-- êµ¬ë… ê´€ë¦¬ (êµ¬ë…ìë§Œ) -->
        <div class="manage-section" id="manage-section" style="display:none;">
            <button class="manage-btn" onclick="cancelSubscription()" style="color:#ef4444; border-color:#ef4444;">êµ¬ë…
                í•´ì§€</button>
        </div>

        <!-- ë¹Œë§ ì£¼ê¸° í† ê¸€ -->
        <div class="billing-toggle-wrap">
            <div class="billing-toggle">
                <button id="billing-monthly" class="active" onclick="setBillingCycle('monthly')">ì›”ê°„</button>
                <button id="billing-yearly" onclick="setBillingCycle('yearly')">ì—°ê°„ <span class="save-badge">20%
                        í• ì¸</span></button>
            </div>
        </div>

        <!-- êµ¬ë… í”Œëœ -->
        <section class="plans-section">
            <h2>êµ¬ë… í”Œëœ</h2>
            <div class="plans-grid" id="plans-grid">
                <!-- Free -->
                <div class="plan-card">
                    <div class="plan-name">Free</div>
                    <div class="plan-price">ë¬´ë£Œ</div>
                    <div class="plan-clips">30 í¬ë ˆë”§ (ê°€ì… ë³´ë„ˆìŠ¤)</div>
                    <ul class="plan-features">
                        <li>ë™ì‹œ ìƒì„± 1ê±´</li>
                        <li>ì¼ì¼ 2ê±´ ì œí•œ</li>
                        <li>720p / ì›Œí„°ë§ˆí¬</li>
                        <li>Gemini 2.5ë§Œ ì‚¬ìš©</li>
                        <li>7ì¼ ë³´ê´€</li>
                    </ul>
                    <button class="plan-btn secondary" disabled>í˜„ì¬ í”Œëœ</button>
                </div>

                <!-- Lite -->
                <div class="plan-card">
                    <div class="plan-name">Lite</div>
                    <div class="plan-price" data-monthly="9900" data-yearly="8250">&#8361;9,900 <span>/ì›”</span></div>
                    <div class="plan-clips">ì›” 150 í¬ë ˆë”§</div>
                    <div style="font-size: 0.85rem; color: #60a5fa; margin-bottom: 8px;">ğŸ¥ ë§¤ì›” ì•½ 6í¸ì˜ ìœ íŠœë¸Œ ìˆí¼ ì œì‘ ê°€ëŠ¥</div>
                    <ul class="plan-features">
                        <li>ë™ì‹œ ìƒì„± 2ê±´</li>
                        <li>ì¼ì¼ 10ê±´ ì œí•œ</li>
                        <li>1080p / ì›Œí„°ë§ˆí¬ ì—†ìŒ</li>
                        <li>I2V ì‚¬ìš© ê°€ëŠ¥</li>
                        <li>Gemini 3.0 ì›” 3íšŒ ë¬´ë£Œ (ì´í›„ ì¶”ê°€ í¬ë ˆë”§)</li>
                        <li>30ì¼ ë³´ê´€</li>
                    </ul>
                    <button class="plan-btn primary" onclick="subscribePlan('lite')">Lite ì‹œì‘</button>
                </div>

                <!-- Pro -->
                <div class="plan-card popular">
                    <div class="plan-name">Pro</div>
                    <div class="plan-price" data-monthly="29900" data-yearly="24917">&#8361;29,900 <span>/ì›”</span></div>
                    <div class="plan-clips">ì›” 500 í¬ë ˆë”§</div>
                    <div style="font-size: 0.85rem; color: #a78bfa; margin-bottom: 8px;">ğŸš€ ë§¤ì›” ì•½ 20~30í¸ì˜ ì˜ìƒ ì–‘ì‚° ê°€ëŠ¥</div>
                    <ul class="plan-features">
                        <li>ë™ì‹œ ìƒì„± 3ê±´</li>
                        <li><strong style="color: #fff;">ì‚¬ì‹¤ìƒ ë¬´ì œí•œ</strong> ìƒì„±</li>
                        <li>1080p / ì›Œí„°ë§ˆí¬ ì—†ìŒ</li>
                        <li>I2V + <strong style="color: #fff;">ë¬´ì œí•œ ì¬ìƒì„±</strong></li>
                        <li>Gemini 3.0 ì›” 10íšŒ ë¬´ë£Œ (ì´í›„ ì¶”ê°€ í¬ë ˆë”§)</li>
                        <li>90ì¼ ë³´ê´€</li>
                    </ul>
                    <button class="plan-btn popular" onclick="subscribePlan('pro')">Pro ì‹œì‘</button>
                </div>

                <!-- Premium -->
                <div class="plan-card">
                    <div class="plan-name">Premium</div>
                    <div class="plan-price" data-monthly="99000" data-yearly="82500">&#8361;99,000 <span>/ì›”</span></div>
                    <div class="plan-clips">ì›” 2,000 í¬ë ˆë”§</div>
                    <div style="font-size: 0.85rem; color: #fbbf24; margin-bottom: 8px;">ğŸ‘‘ í—¤ë¹„ ìœ ì € ë° B2B ì±„ë„ ìš´ì˜ìš©ê¸‰ ìš©ëŸ‰</div>
                    <ul class="plan-features">
                        <li>ë™ì‹œ ìƒì„± 3ê±´</li>
                        <li>ë¬´ì œí•œ ìƒì„±</li>
                        <li>1080p / ì›Œí„°ë§ˆí¬ ì—†ìŒ</li>
                        <li>I2V + ë¬´ì œí•œ ì¬ìƒì„±</li>
                        <li>Gemini 3.0 ë¬´ì œí•œ</li>
                        <li>90ì¼ ë³´ê´€</li>
                    </ul>
                    <button class="plan-btn primary" onclick="subscribePlan('premium')">Premium ì‹œì‘</button>
                </div>
            </div>
        </section>

        <!-- í¬ë ˆë”§ íŒ© -->
        <section class="packs-section">
            <h2>í¬ë ˆë”§ íŒ© (ì¼íšŒì„±)</h2>
            <p style="text-align: center; color: #888; font-size: 0.9rem; margin-top: -16px; margin-bottom: 32px;">êµ¬ë…ì´
                ë¶€ë‹´ë¡œìš°ì‹ ê°€ìš”? í¸í•˜ê²Œ í•„ìš”í•œ ë§Œí¼ë§Œ ì¶©ì „í•´ì„œ ì¨ë³´ì„¸ìš”!</p>
            <div class="packs-grid">
                <div class="pack-card">
                    <div class="pack-clips">50</div>
                    <div>í¬ë ˆë”§</div>
                    <div class="pack-price">&#8361;5,900</div>
                    <div class="pack-unit">&#8361;118 / í¬ë ˆë”§</div>
                    <button class="pack-btn" onclick="buyPack('small')">êµ¬ë§¤</button>
                </div>
                <div class="pack-card">
                    <div class="pack-clips">200</div>
                    <div>í¬ë ˆë”§</div>
                    <div class="pack-price">&#8361;17,900</div>
                    <div class="pack-unit">&#8361;90 / í¬ë ˆë”§</div>
                    <button class="pack-btn" onclick="buyPack('medium')">êµ¬ë§¤</button>
                </div>
                <div class="pack-card">
                    <div class="pack-clips">500</div>
                    <div>í¬ë ˆë”§</div>
                    <div class="pack-price">&#8361;35,900</div>
                    <div class="pack-unit">&#8361;72 / í¬ë ˆë”§</div>
                    <button class="pack-btn" onclick="buyPack('large')">êµ¬ë§¤</button>
                </div>
            </div>
        </section>

        <!-- í¬ë ˆë”§ ë¹„ìš© í‘œ -->
        <section class="costs-section">
            <h2>ì•¡ì…˜ë³„ í¬ë ˆë”§ ì†Œë¹„</h2>
            <table class="costs-table">
                <thead>
                    <tr>
                        <th>ì•¡ì…˜</th>
                        <th>í¬ë ˆë”§</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>AI ìŠ¤í† ë¦¬ ì˜ìƒ</td>
                        <td>25</td>
                    </tr>
                    <tr>
                        <td>ìŠ¤í¬ë¦½íŠ¸ ì§ì ‘ ì˜ìƒ</td>
                        <td>25</td>
                    </tr>
                    <tr>
                        <td>ë®¤ì§ë¹„ë””ì˜¤ (MV)</td>
                        <td>15</td>
                    </tr>
                    <tr>
                        <td>ì´ë¯¸ì§€ ì¬ìƒì„±</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>I2V ë³€í™˜</td>
                        <td>30</td>
                    </tr>
                    <tr>
                        <td>MV ë¦¬ì»´í¬ì¦ˆ</td>
                        <td>8</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- ê±°ë˜ ë‚´ì—­ -->
        <section class="history-section" id="history-section" style="display:none;">
            <h2>ê±°ë˜ ë‚´ì—­</h2>
            <ul class="tx-list" id="tx-list"></ul>
            <button class="load-more-btn" id="load-more-btn" onclick="loadMoreHistory()" style="display:none;">ë”
                ë³´ê¸°</button>
        </section>
    </div>

    <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
    <script src="/static/auth.js"></script>
    <script>
        const WORKER = window.location.hostname === 'localhost' ? '' : 'https://storycut-worker.twinspa0713.workers.dev';
        let billingCycle = 'monthly';
        let historyPage = 1;
        let paymentInProgress = false;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            checkUrlParams();
            await loadPricingData();
            loadTransactionHistory();
        });

        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('success') === 'true') {
                showBanner('ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! í¬ë ˆë”§ì´ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                setTimeout(() => { if (typeof fetchClipBalance === 'function') fetchClipBalance(); }, 1000);
            }
            if (params.get('cancelled') === 'true') {
                showBanner('ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
            }
        }

        function showBanner(msg, type) {
            const banner = document.getElementById('success-banner');
            banner.textContent = msg;
            banner.style.display = 'block';
            if (type === 'warning') {
                banner.style.background = '#f59e0b22';
                banner.style.borderColor = '#f59e0b44';
                banner.style.color = '#f59e0b';
            }
        }

        async function loadPricingData() {
            const token = localStorage.getItem('token');
            if (!token) return;

            try {
                const res = await fetch(`${WORKER}/api/clips/balance`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!res.ok) {
                    if (res.status === 401) { logout(); return; }
                    return;
                }

                const data = await res.json();

                // ì”ì•¡ ì¹´ë“œ
                document.getElementById('balance-card').style.display = 'block';
                document.getElementById('pricing-clip-count').textContent = data.clips;

                const badge = document.getElementById('pricing-plan-badge');
                const planId = data.plan_id || 'free';
                badge.textContent = data.plan_name || 'Free';
                badge.className = `plan-badge ${planId}`;

                // êµ¬ë… ê´€ë¦¬ í‘œì‹œ
                if (planId !== 'free') {
                    document.getElementById('manage-section').style.display = 'block';
                }

                updatePlanButtons(planId);
            } catch (err) {
                console.error('Failed to load pricing data:', err);
            }
        }

        function updatePlanButtons(currentPlan) {
            const plans = ['free', 'lite', 'pro', 'premium'];
            const cards = document.querySelectorAll('.plan-card');
            cards.forEach((card, i) => {
                const btn = card.querySelector('.plan-btn');
                const planId = plans[i];
                if (planId === currentPlan) {
                    btn.textContent = 'í˜„ì¬ í”Œëœ';
                    btn.disabled = true;
                    btn.className = 'plan-btn secondary';
                }
            });
        }

        function _pricingToast(msg, type = 'info') {
            const toast = document.createElement('div');
            toast.textContent = msg;
            Object.assign(toast.style, {
                position: 'fixed', bottom: '20px', left: '50%', transform: 'translateX(-50%)',
                padding: '12px 24px', borderRadius: '8px', zIndex: '9999',
                color: '#fff', fontSize: '14px', fontWeight: '500',
                background: type === 'error' ? '#e53e3e' : type === 'success' ? '#38a169' : '#3182ce',
                boxShadow: '0 4px 12px rgba(0,0,0,0.15)', transition: 'opacity 0.3s',
            });
            document.body.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        function formatKrw(num) {
            return '\u20A9' + Number(num).toLocaleString('ko-KR');
        }

        function setBillingCycle(cycle) {
            billingCycle = cycle;
            document.getElementById('billing-monthly').classList.toggle('active', cycle === 'monthly');
            document.getElementById('billing-yearly').classList.toggle('active', cycle === 'yearly');

            document.querySelectorAll('.plan-price[data-monthly]').forEach(el => {
                const price = cycle === 'yearly' ? el.dataset.yearly : el.dataset.monthly;
                el.innerHTML = formatKrw(price) + ' <span>/ì›”</span>';
            });
        }

        // ==================== í¬ë ˆë”§ íŒ© êµ¬ë§¤ (PortOne ì¼íšŒê²°ì œ) ====================

        async function buyPack(packType) {
            const token = localStorage.getItem('token');
            if (!token) { window.location.href = '/login.html'; return; }
            _pricingToast('ê²°ì œ ì‹œìŠ¤í…œ ì—°ë™ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!', 'info');
            /*
            if (paymentInProgress) return;
            paymentInProgress = true;

            try {
                // ... payment logic hidden ...
            } catch (err) {
                _pricingToast(err.message, 'error');
            } finally {
                paymentInProgress = false;
            }
            */
        }

        // ==================== êµ¬ë… (PortOne ë¹Œë§í‚¤ ë°œê¸‰ â†’ ì²« ê²°ì œ) ====================

        async function subscribePlan(planId) {
            const token = localStorage.getItem('token');
            if (!token) { window.location.href = '/login.html'; return; }
            _pricingToast('ê²°ì œ ì‹œìŠ¤í…œ ì—°ë™ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!', 'info');
            /*
            if (paymentInProgress) return;
            paymentInProgress = true;

            try {
                // ... payment logic hidden ...
            } catch (err) {
                _pricingToast(err.message, 'error');
            } finally {
                paymentInProgress = false;
            }
            */
        }

        // ==================== êµ¬ë… í•´ì§€ ====================

        async function cancelSubscription() {
            if (!confirm('êµ¬ë…ì„ í•´ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ê²°ì œ ê¸°ê°„ì´ ëë‚  ë•Œê¹Œì§€ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.')) return;

            const token = localStorage.getItem('token');
            try {
                const res = await fetch(`${WORKER}/api/payments/cancel-subscription`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'í•´ì§€ ì‹¤íŒ¨');

                _pricingToast('êµ¬ë…ì´ í•´ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ê²°ì œ ê¸°ê°„ì´ ëë‚  ë•Œê¹Œì§€ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'success');
                setTimeout(() => location.reload(), 2000);
            } catch (err) {
                _pricingToast(err.message, 'error');
            }
        }

        // ==================== ê±°ë˜ ë‚´ì—­ ====================

        async function loadTransactionHistory() {
            const token = localStorage.getItem('token');
            if (!token) return;

            try {
                const res = await fetch(`${WORKER}/api/clips/history?page=${historyPage}&limit=15`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!res.ok) return;

                const data = await res.json();
                const section = document.getElementById('history-section');
                const list = document.getElementById('tx-list');

                if (data.transactions && data.transactions.length > 0) {
                    section.style.display = 'block';

                    data.transactions.forEach(tx => {
                        const li = document.createElement('li');
                        li.className = 'tx-item';
                        const isPositive = tx.amount > 0;
                        const date = new Date(tx.created_at).toLocaleDateString('ko-KR', {
                            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                        });
                        li.innerHTML = `
                            <div>
                                <div class="tx-desc">${tx.description || tx.action || tx.type}</div>
                                <div class="tx-date">${date}</div>
                            </div>
                            <div class="tx-amount ${isPositive ? 'positive' : 'negative'}">
                                ${isPositive ? '+' : ''}${tx.amount}
                            </div>
                        `;
                        list.appendChild(li);
                    });

                    if (data.pagination.page < data.pagination.pages) {
                        document.getElementById('load-more-btn').style.display = 'block';
                    } else {
                        document.getElementById('load-more-btn').style.display = 'none';
                    }
                }
            } catch (err) {
                console.error('Failed to load tx history:', err);
            }
        }

        function loadMoreHistory() {
            historyPage++;
            loadTransactionHistory();
        }
    </script>
</body>

</html>